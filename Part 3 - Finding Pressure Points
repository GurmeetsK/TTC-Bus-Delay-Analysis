We will start with the specifics of which incidents occurred within different time lengths
 
SELECT Incident, COUNT(INCIDENT), month(date)
FROM `toronto bus delay`
GROUP BY Incident, month(date)
ORDER BY month(date) asc
 
Immediately, we can see that the most incidents all around are Operations or Mechnical related.
 
If we do a similar query for days of the week, we can see a similar result:
 
SELECT Incident, Day, COUNT(Incident)
FROM `toronto bus delay`
GROUP BY Incident, Day
 
After noticing that Operations and Mechanical are the highest incidents in these queries, 
We can confirm the same by using OVER in our basic query to see percentages
 
SELECT `Incident`,
COUNT(*),
COUNT(*) * 100 / sum(count(*)) over() as 'percenttotal'
FROM `toronto bus delay`
GROUP BY Incident
ORDER BY 'percenttotal' desc
 
The bigger issue, of course, would be how much of a delay these incidents cause,
So we can do another query to understand which incidents cause most delays:
 
SELECT `Incident`,
sum(`Min Delay`) totaldelay
FROM `toronto bus delay`
GROUP BY Incident
ORDER BY totaldelay desc
 
We notice that the topmost delay is Diversion. 
Though there are only around 4.5% of incidents related to diversion, 28% of the minutes delayed are through diversion.
We can confirm that the top 3 most troublesome incidents are Diversion, Operations and Mechanical. 

We also want to see through other means if Operations, Diversion and Mechanical are indeed the most pressing incidents.

We will start with Route Types -

SELECT Incident, COUNT(Incident),
CASE 
	WHEN ROUTE BETWEEN 7 AND 189 THEN 'Regular'
    WHEN ROUTE BETWEEN 900 AND 999 THEN 'Express'
    WHEN ROUTE BETWEEN 300 AND 399 THEN 'Night'
    WHEN ROUTE BETWEEN 400 AND 499 THEN 'HubConnectors'
    ELSE 'Undefined'
    END AS 'Bus Type'
FROM `toronto bus delay`
GROUP BY `Bus Type`, Incident WITH ROLLUP
ORDER BY COUNT(Incident) desc

Immediately we can see that approximately 25% of all Incidents are on regular route types with operation as Incident. Mechanical comes next. Diversion,
while low(comparitively), is still in the top 10 most Incidents by route type. We also see Security and Collision as quite high numbers.

For our next query we will tweak the above one slightly. This is to check for Delay while also confirming if Diversion is indeed the highest and to 
see if Security and Collision are causes for concern in terms of traffic causing incidents.

SELECT Incident, COUNT(Incident), sum(`Min Delay`),
CASE 
	WHEN ROUTE BETWEEN 7 AND 189 THEN 'Regular'
    WHEN ROUTE BETWEEN 900 AND 999 THEN 'Express'
    WHEN ROUTE BETWEEN 300 AND 399 THEN 'Night'
    WHEN ROUTE BETWEEN 400 AND 499 THEN 'HubConnectors'
    ELSE 'Undefined'
    END AS 'Bus Type'
FROM `toronto bus delay`
GROUP BY `Bus Type`, Incident 
ORDER BY COUNT(Incident) desc

We notice that Diversion is extremely high in delay(highest of all) and Security and Collision are way less in comparison to the top 3.

----- Next do the same as above forvehicle type 
And then test to see if vehicle type is a factor in delays(are diesel cars more delay causing than others etc)



TBC ---

Hence, the two queries each below to dive deeper into these 3 incidents.
 
Mechanical:
 
SELECT Location,
COUNT(Incident),
avg(`Min Delay`)
FROM `toronto bus delay`
WHERE Incident = 'Mechanical'
GROUP BY Location
ORDER BY COUNT(Incident) desc
 
SELECT month(date),
COUNT(Incident),
avg(`Min Delay`)
FROM `toronto bus delay`
WHERE Incident = 'Mechanical'
GROUP BY month(date)
ORDER BY COUNT(Incident) desc
 
Operations:
 
SELECT Location,
COUNT(Incident),
avg(`Min Delay`)
FROM `toronto bus delay`
WHERE Incident = 'Operations - Operator'
GROUP BY Location
ORDER BY COUNT(Incident) desc
 
SELECT month(date),
COUNT(Incident),
avg(`Min Delay`)
FROM `toronto bus delay`
WHERE Incident = 'Operations - Operator'
GROUP BY month(date)
ORDER BY COUNT(Incident) desc
 
Diversion:
 
SELECT Location,
COUNT(Incident),
avg(`Min Delay`)
FROM `toronto bus delay`
WHERE Incident = 'Diversion'
GROUP BY Location
ORDER BY COUNT(Incident) desc
 
SELECT month(date),
COUNT(Incident),
avg(`Min Delay`)
FROM `toronto bus delay`
WHERE Incident = 'Diversion'
GROUP BY month(date)
ORDER BY COUNT(Incident) desc
